'use strict';Vue.component('awe-carousel',{props:{products:{type:Array,value:[]},defaultEan:{type:String,default:''},rtl:{type:Boolean,value:!1},scrollMode:{type:String,default:'hover',validator:t=>['hover','longClick','click'].includes(t)},speed:{type:Number,default:560},fit:{type:Boolean,default:!1},pagination:{type:Boolean,default:!1}},data:function(){return{scrollOffset:0,selectedIdx:-1,eventTypeSelection:!1,minpos:Number,swipeStartX:-1,updateTimeout:-1,rafid:0,_baseItemWidth:0,_fitTimeoutId:0,paginationObserver:null,PAGINATION_ROOT_MARGIN:'200px',PAGINATION_THRESHOLD:.1}},computed:{computedStyle:function(){return{'-webkit-transform':`translateX(${this.scrollOffset}px)`,transform:`translateX(${this.scrollOffset}px)`}}},watch:{defaultEan:function(){this.scrollToDefault('defaultEan')},products:function(){this.scrollToDefault('products'),this.pagination&&this.paginationObserver&&(this.paginationObserver.disconnect(),this.$nextTick().then((()=>{const t=this.$el.querySelector('.content .pdt:last-child');t&&this.paginationObserver.observe(t)})))}},created:function(){},mounted:function(){const t=this.$el.getElementsByClassName('scroll-btn');for(let e=0;e<t.length;e++)'hover'===this.scrollMode?(t[e].addEventListener('mouseenter',this.startScroll,{passive:!0}),t[e].addEventListener('mouseleave',this.endScroll,{passive:!0})):'longClick'===this.scrollMode?(t[e].addEventListener('mousedown',this.startScroll,{passive:!0}),t[e].addEventListener('mouseup',this.endScroll,{passive:!0})):'click'===this.scrollMode&&t[e].addEventListener('click',this.startScroll,{passive:!0}),'click'!==this.scrollMode&&(t[e].addEventListener('touchstart',this.startScroll,{passive:!0}),t[e].addEventListener('touchend',this.endScroll,{passive:!0}));const e=this.$el.getElementsByClassName('content')[0];e.addEventListener('touchstart',this.swipeStart,{passive:!0}),e.addEventListener('touchmove',this.swipe,{passive:!0}),this.fit&&this.startObservers(),this.products&&(this.defaultEan?this.selectedIdx=Math.max(0,this.products.findIndex((t=>t.ean===this.defaultEan))):this.selectedIdx=0),this.pagination&&window.IntersectionObserver&&!this.paginationObserver&&(this.paginationObserver=new IntersectionObserver(((t,e)=>{t[0].intersectionRatio>=e.thresholds[0]&&(this.$emit('pagination-request'),e.disconnect())}),{root:this.$el.getElementsByClassName('scroll-ctnr')[0],rootMargin:this.PAGINATION_ROOT_MARGIN,threshold:this.PAGINATION_THRESHOLD}))},updated:function(){-1==this.updateTimeout&&(this.updateTimeout=setTimeout((async()=>{await this.$nextTick();const t=this.$el.getElementsByClassName('scroll-ctnr')[0],e=this.$el.getElementsByClassName('content')[0],s=t&&t.getBoundingClientRect().width,i=(e&&e.getBoundingClientRect().width)>s,n=this.$el.getElementsByClassName('scroll-btn');for(let t=0;t<n.length;t++)i?n[t].classList.remove('hidden'):n[t].classList.add('hidden');this.updateTimeout=-1}),50))},methods:{scrollToDefault:async function(t){this.selectedIdx=Math.max(0,this.products.findIndex((t=>t.ean===this.defaultEan)));const e=this.$el.querySelector(`.pdt:nth-child(${this.selectedIdx+1})`);if(!e)return;'products'===t&&await this.$nextTick();const s=this.$el.getElementsByClassName('content')[0],i=e.getBoundingClientRect(),n=s.getBoundingClientRect();n.width>n.height?(this.updateMinPos(s),this.scrollOffset+=n.x-i.x,this.respectBoundaries(),this.scrollOffset<0?this.$el.querySelector('.scroll-btn.left').classList.remove('disabled'):this.$el.querySelector('.scroll-btn.left').classList.add('disabled'),this.scrollOffset===this.minPos?this.$el.querySelector('.scroll-btn.right').classList.add('disabled'):this.$el.querySelector('.scroll-btn.right').classList.remove('disabled')):e.scrollIntoView({behavior:'auto',block:'center'})},startScroll:function(t){if(t.currentTarget.classList.contains('disabled'))return;if(!this.eventTypeSelection){let e=this.$el.getElementsByClassName('scroll-btn');'touchstart'===t.type?'hover'===this.scrollMode?this.unregisterEvents(e,'mouseenter','mouseleave'):'longClick'===this.scrollMode&&this.unregisterEvents(e,'mousedown','mouseup'):'mouseenter'!==t.type&&'mousedown'!==t.type||this.unregisterEvents(e,'touchstart','touchend'),this.eventTypeSelection=!0}var e=t.currentTarget,s=e.classList.contains('right')?-this.speed:this.speed,i=this.$el.querySelector('.scroll-btn.disabled');i&&i.classList.remove('disabled'),e.classList.add('hover');const n=this.$el.getElementsByClassName('content')[0];let l;if(this.updateMinPos(n),'click'===this.scrollMode){l=n.children[0].getBoundingClientRect().width;const t=window.getComputedStyle(n.children[0]),e=(parseFloat(t.marginLeft)||0)+(parseFloat(t.marginRight)||0);l+=e}this.paginationObserver&&this.paginationObserver.observe(this.$el.querySelector('.pdt:last-child'));const o=this.scrollOffset;let r,a=!1;const c=t=>{if(!r)return r=t,void(this.rafid=window.requestAnimationFrame(c));const i=t-r;let n=i*s/1e3;'click'===this.scrollMode&&Math.abs(n)>l&&(n=n>0?l:-l,a=!0),this.scrollOffset=o+n,this.respectBoundaries(),i>0&&(0===this.scrollOffset||this.scrollOffset===this.minPos)?(window.cancelAnimationFrame(this.rafid),e.classList.add('disabled'),e.classList.remove('hover')):a?window.cancelAnimationFrame(this.rafid):this.rafid=window.requestAnimationFrame(c)};this.rafid=window.requestAnimationFrame(c)},endScroll:function(t){window.cancelAnimationFrame(this.rafid),t.currentTarget.classList.remove('hover')},swipeStart:function(t){this.swipeStartX=t.touches[0].screenX,this.updateMinPos(t.currentTarget),this.paginationObserver&&this.paginationObserver.observe(this.$el.querySelector('.pdt:last-child'))},swipe:function(t){const e=t.touches[0].screenX,s=this._toInt(e-this.swipeStartX);this.swipeStartX=e;var i=this.$el.querySelector('.scroll-btn.left'),n=this.$el.querySelector('.scroll-btn.right');if(s<0&&([i,n]=[n,i]),!i.classList.contains('disabled')){var l=this.$el.querySelector('.scroll-btn.disabled');l&&l.classList.remove('disabled'),i.classList.add('hover'),n.classList.remove('hover'),this.scrollOffset+=s,this.respectBoundaries(),setTimeout((()=>{(0===this.scrollOffset&&s>0||this.scrollOffset===this.minPos&&s<0)&&(i.classList.add('disabled'),i.classList.remove('hover'))}),100)}},respectBoundaries:function(){this.rtl?(this.scrollOffset=Math.max(this.scrollOffset,0),this.scrollOffset=Math.min(this.scrollOffset,this.minPos)):(this.scrollOffset=Math.min(this.scrollOffset,0),this.scrollOffset=Math.max(this.scrollOffset,this.minPos))},updateMinPos:function(t){var e=this.$el.children[1];this.rtl?this.minPos=Math.max(0,t.scrollWidth-e.offsetWidth):this.minPos=Math.min(0,e.offsetWidth-t.scrollWidth)},unregisterEvents:function(t,e,s){for(let i=0;i<t.length;i++)t[i].removeEventListener(e,this.startScroll),t[i].removeEventListener(s,this.endScroll)},_toInt:t=>t>0?Math.ceil(t):t<0?Math.floor(t):t,resizeItems:function(){const t=this.$el.getElementsByClassName('scroll-ctnr')[0],e=this.$el.getElementsByClassName('content')[0],s=t.getBoundingClientRect().width;if(e.getBoundingClientRect().width<=s)return;this._baseItemWidth||(this._baseItemWidth=e.children[0].getBoundingClientRect().width);const i=window.getComputedStyle(e.children[0]),n=(parseFloat(i.marginLeft)||0)+(parseFloat(i.marginRight)||0);let l=s/(this._baseItemWidth+n);l=l%1>=.8?Math.ceil(l):Math.floor(l);const o=s/l-n;console.debug(`cntr: ${s} / width: ${this._baseItemWidth}ðŸ –${o}, margins: ${n}`);for(let t=0;t<e.childElementCount;t++){const s=e.children[t];s.style.width=o.toFixed(2)+'px',s.style['min-width']='auto',s.style['max-width']='auto'}},startObservers:function(){if(!window.MutationObserver)return;const t=(t,e)=>{this._fitTimeoutId||(this._fitTimeoutId=setTimeout((()=>{this.resizeItems(),this._fitTimeoutId=0}),250))},e=new MutationObserver(t),s=this.$el.getElementsByClassName('content')[0];if(e.observe(s,{childList:!0}),window.ResizeObserver){new ResizeObserver(t).observe(this.$el.getElementsByClassName('scroll-ctnr')[0])}},selectPdt:function(t){t.stopPropagation();let e=null,s=t.target;for(;null==e&&!s.classList.contains('scroll-ctnr');)s.classList.contains('pdt')?e=s:s=s.parentElement;e&&(this.selectedIdx=parseInt(e.dataset.idx,10),this.$emit('product-select',this.products[this.selectedIdx]))}},template:'\n    <div class="carousel">\n      <div name="left-btn" class="scroll-btn left" v-bind:class="{disabled: !rtl, rtl: rtl}" tabindex="0">\n      </div>\n\n      <div class="scroll-ctnr">\n        <div class="content" role="list" :style="computedStyle" v-on:click="selectPdt" v-on:keypress.enter="selectPdt">\n          <div v-for="(pdt, i) in products" class="pdt" v-bind:class="{selected: i === selectedIdx}"\n           :data-ean="pdt.ean" :data-idx="i" role="listitem" tabindex="0">\n            <slot v-bind:pdt="pdt" v-bind:i="i">\n            </slot>\n          </div>\n        </div>\n      </div>\n\n      <div name="right-btn" class="scroll-btn right" v-bind:class="{disabled: rtl, rtl: rtl}" tabindex="0">\n      </div>\n    </div>\n  '});
//# sourceMappingURL=carousel.js.map
