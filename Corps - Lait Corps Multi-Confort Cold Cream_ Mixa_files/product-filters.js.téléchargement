'use strict';Vue.component('awe-product-filters',{props:{filtersDefinition:{type:Array,default:()=>[]},products:{type:Array,default:()=>[]},customTags:{type:Object,default:()=>({})},presetString:{type:String,default:''},locale:{type:String,default:'en'}},data:function(){return{filterGroups:[],showReset:!1,isOpen:!0,isExpanded:!1,State:{CHECKED:1,UNCHECKED:0,DISABLED:-1},i18n:this.$root.i18n}},computed:{baseLang:function(){return this.locale.substring(0,2)},preset:function(){return this.parsePreset(this.presetString)},toggleLbl:function(){return this.isOpen?'FILTERS_TOGGLE_OPEN':'FILTERS_TOGGLE_CLOSED'}},watch:{filtersDefinition:function(){this.getFilterGroups(this.products)},customTags:function(){this.getFilterGroups(this.products)},products:function(){this.getFilterGroups(this.products)},preset:function(){this.getFilterGroups(this.products)}},mounted:function(){this.products.length>0&&this.filtersDefinition.length>0&&this.getFilterGroups(this.products)},updated:function(){this.setShowMore()},methods:{getFilterGroups:function(t){if(0===this.products.length||0===this.filtersDefinition.length||0===this.customTags.length)return[];const e=[];this.filtersDefinition.forEach((s=>{let i;s.startsWith('tags.')?(i='tags',s=s.split('.')[1]):i='props';const r=new Set,n={target:i,name:s,filters:null};t.forEach((t=>{'tags'===i?t.tags&&t.tags[s]&&t.tags[s].forEach((t=>r.add(t))):t[s]&&r.add(t[s])})),n.filters=Array.from(r),e.push(n)})),this.filterGroups=this._processFilters(e),this.preset&&this.refresh()},_processFilters:function(t){return t.forEach((t=>{if('tags'===t.target){const e=this.customTags[t.name]?this.customTags[t.name].map((t=>t.key)):[];t.filters.sort(((t,s)=>e.indexOf(t)-e.indexOf(s))),t.filters=t.filters.map((e=>{const s=this.customTags[t.name];if(s){const i=s.find((t=>t.key===e));if(i){const s=this.preset&&this.preset[t.name]&&this.preset[t.name].includes(i.key);return{tag:e,label:i.label,state:s?this.State.CHECKED:this.State.UNCHECKED}}}})).filter((t=>!!t))}else t.filters.sort(Utils.alphanumericSort),t.filters=t.filters.map((e=>{const s=this.preset&&this.preset[t.name]&&this.preset[t.name].includes(e.toLowerCase());return{tag:e,label:e,state:s?this.State.CHECKED:this.State.UNCHECKED}}))})),t},filterProducts:function(){let t=this.products;return this.filterGroups.forEach((e=>{const s=e.filters.filter((t=>t.state===this.State.CHECKED)).map((t=>t.tag));if(0===s.length)return this.products;t=t.filter((t=>s.some((s=>this.hasFilterTag(e,t,s)))))})),t},toggle:function(t){t.state!==this.State.DISABLED&&(t.state=t.state===this.State.CHECKED?this.State.UNCHECKED:this.State.CHECKED,this.refresh(t))},refresh:function(t){const e=this.filterProducts();this.setDisabledFilters(e),t&&t.state===this.State.CHECKED?this.showReset=!0:this.showReset=this.filterGroups.some((t=>t.filters.some((t=>t.state===this.State.CHECKED)))),this.$emit('product-filters-update',e),this.$root.trigger('product-filters-update',Utils.clone(e))},hasFilterTag:function(t,e,s){return'tags'===t.target?e.tags&&e.tags[t.name]&&e.tags[t.name].indexOf(s)>-1:e[t.name]===s},setDisabledFilters:function(t){this.filterGroups.forEach((e=>{e.filters.some((t=>t.state===this.State.CHECKED))?e.filters.filter((t=>t.state===this.State.DISABLED)).forEach((t=>t.state=this.State.UNCHECKED)):e.filters.forEach((s=>{!t.some((t=>this.hasFilterTag(e,t,s.tag)))?s.state=this.State.DISABLED:s.state===this.State.DISABLED&&(s.state=this.State.UNCHECKED)}))}))},reset:function(t){this.filterGroups.forEach((t=>t.filters.forEach((t=>t.state=this.State.UNCHECKED)))),this.$emit('product-filters-update',this.products),this.$root.trigger('product-filters-update',Utils.clone(this.products)),this.showReset=!1},setShowMore:function(){if(this.$el.classList.contains('closed')||this.$el.classList.contains('expanded'))return;if(this.$el.getBoundingClientRect().width>630)return;const t=this.$el.getElementsByClassName('filtertag');let e,s=!1,i=0,r=0,n=null;if(0!==t.length){for(;!s;){const o=t[i];if(!o)return;const a=o.getBoundingClientRect().top;a===e&&e||(e=a,r++),3===r?(s=!0,n=t[i-1]):i===t.length-1&&(s=!0),i++}if(n){const t=n.getBoundingClientRect(),e=document.getElementById('show-more');if(!e||!t)return;e.style.top=`${n.offsetTop}px`,e.classList.remove('hidden')}}},getStateClass:function(t){let e='';switch(t){case this.State.CHECKED:e='checked';break;case this.State.UNCHECKED:e='unchecked';break;case this.State.DISABLED:e='disabled'}return e},togglePanel:function(){this.isOpen=!this.isOpen,this.isExpanded=!1,this.isOpen||document.getElementById('show-more').classList.add('hidden')},toggleMore:function(t){this.isExpanded=!this.isExpanded,t.target.classList.add('hidden')},parsePreset:function(t){if(!t)return null;var e={};return decodeURIComponent(t).split('/').forEach((t=>{if(!t)return;let[s,i]=t.split(':');s=s.trim(),i=i.split(',').map((t=>t.trim().toLowerCase())).filter((t=>t)),i.length>0&&(e[s]=i)})),e}},template:'\n  <div class="product-filters" v-bind:class="{ \'closed\' : !isOpen, \'expanded\' : isExpanded }" role="listbox">\n    <div class="filters-content" :aria-disabled="!isOpen">\n      <span id="reset" class="icon icon-cancel" v-on:keypress.enter="reset" v-on:click="reset"\n        v-show="showReset" :aria-disabled="!showReset" :aria-label="i18n.getString(\'FILTERS_RESET\')"\n        :title="i18n.getString(\'FILTERS_RESET\')" role="button" :tabindex="showReset ? 0 : -1">\n      </span>\n      <template v-for="group in filterGroups">\n        <div v-for="filter in group.filters" class="filtertag" v-bind:class="getStateClass(filter.state)" v-on:click="toggle(filter)" v-on:keypress.enter="toggle(filter)" :tabindex="filter.state === State.DISABLED ? -1 : 0" role="option">\n          <slot name="filter-tag" v-bind:filter="filter">\n            <label class="lbl">{{filter.label}}</label>\n          </slot>\n        </div>\n      </template>\n      <span id="filter-toggler" v-on:click="togglePanel" v-on:keypress.enter="togglePanel"\n        role="button" :aria-label="i18n.getString(toggleLbl)" :title="i18n.getString(toggleLbl)"\n        tabindex="0">^</span>\n      <span id="show-more" class="icon icon-ellipsis hidden" v-on:keypress.enter="toggleMore" v-on:click="toggleMore" role="button">\n      </span>\n    </div>\n  </div>\n  '});
//# sourceMappingURL=product-filters.js.map
